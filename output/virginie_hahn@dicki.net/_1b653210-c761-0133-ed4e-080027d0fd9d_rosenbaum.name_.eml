Date: Sun, 06 Mar 2016 21:10:38 +0000
From: Marcellus Bailey <karlie@rosenbaum.name>
To: virginie_hahn@dicki.net
Message-ID: <1b653210-c761-0133-ed4e-080027d0fd9d@rosenbaum.name>
Subject: Spark-sql error by defining UDAF
Mime-Version: 1.0
Content-Type: multipart/alternative;
 boundary="--==_mimepart_56ded611bc54b_118541a29ae906ea";
 charset=UTF-8
Content-Transfer-Encoding: 7bit


----==_mimepart_56ded611bc54b_118541a29ae906ea
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

Spark version 1.6.0 on AWS EMR with Zeppelin Notebook

I defined a UDAF with following codes:

import org.apache.spark.sql.types._
import org.apache.spark.sql.Row;
import org.apache.spark.sql.expressions.MutableAggregationBuffer
import org.apache.spark.sql.expressions.UserDefinedAggregateFunction

import java.text.SimpleDateFormat
import java.util.Date

class AggregateTS extends UserDefinedAggregateFunction{
    def inputSchema: StructType = StructType(StructField("input", StringType) :: Nil)

    def bufferSchema: StructType = StructType(StructField("intermediate", StringType)::Nil)

    def dataType: DataType = StringType

    def deterministic: Boolean = true

    def initialize(buffer: MutableAggregationBuffer): Unit = {
        buffer(0) = "Init"
    }

    def update(buffer: MutableAggregationBuffer, input: Row): Unit = {
        if (buffer.getAs[String](0) == "Init"){
            buffer(0) = input.getAs[String](0)
        }
        else{
            // add two string
            buffer(0) = average_ts(input.getAs[String](0), buffer.getAs[String](0))
        }
    }

    def merge(buffer1: MutableAggregationBuffer, buffer2:Row):Unit = {
        buffer1(0) = average_ts(buffer1.getAs[String](0), buffer2.getAs[String](0))
    }

    def evaluate(buffer: Row): Any = {
        buffer.getAs[String](0)
    }
}


from which I got a compile error:

error: not found: type DataType
       def dataType: DataType = StringType


What does it mean ?
----==_mimepart_56ded611bc54b_118541a29ae906ea
Content-Type: text/html;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

<p>Spark version 1.6.0 on AWS EMR with Zeppelin Notebook</p>

<p>I defined a UDAF with following codes:</p>

<pre><code>import org.apache.spark.sql.types._
import org.apache.spark.sql.Row;
import org.apache.spark.sql.expressions.MutableAggregationBuffer
import org.apache.spark.sql.expressions.UserDefinedAggregateFunction

import java.text.SimpleDateFormat
import java.util.Date

class AggregateTS extends UserDefinedAggregateFunction{
    def inputSchema: StructType = StructType(StructField("input", StringType) :: Nil)

    def bufferSchema: StructType = StructType(StructField("intermediate", StringType)::Nil)

    def dataType: DataType = StringType

    def deterministic: Boolean = true

    def initialize(buffer: MutableAggregationBuffer): Unit = {
        buffer(0) = "Init"
    }

    def update(buffer: MutableAggregationBuffer, input: Row): Unit = {
        if (buffer.getAs[String](0) == "Init"){
            buffer(0) = input.getAs[String](0)
        }
        else{
            // add two string
            buffer(0) = average_ts(input.getAs[String](0), buffer.getAs[String](0))
        }
    }

    def merge(buffer1: MutableAggregationBuffer, buffer2:Row):Unit = {
        buffer1(0) = average_ts(buffer1.getAs[String](0), buffer2.getAs[String](0))
    }

    def evaluate(buffer: Row): Any = {
        buffer.getAs[String](0)
    }
}
</code></pre>

<p>from which I got a compile error:</p>

<pre><code>error: not found: type DataType
       def dataType: DataType = StringType
</code></pre>

<p>What does it mean ?</p>
----==_mimepart_56ded611bc54b_118541a29ae906ea--
