require 'simple-rss'
require 'open-uri'
require 'mail'


module RSSHandle

  class Getter
    attr_reader :thread
    # class in charge of getting the RSS feeds


    private


    def initialize url
      puts "getting feeds from: #{url}"

      @url = url

      @thread = Thread.new rss.feed.title


      rss.feed.items.each do |item|
        @thread.add item
      end

    end

    def rss
      @rss ||= SimpleRSS.parse open(@url)
    end



  end

  class Thread

    def add feed
      message = Message.new @subject, feed.author, feed.published, feed.summary
      @messages << message

      message.write_eml
    end


    private

    def initialize subject
      @subject = subject
      @messages = []
    end




  end


  class Message

    def write_eml
      mail = Mail.new do
        from    'mikel@test.lindsaar.net'
        to      'you@test.lindsaar.net'
        subject @subject
        body    @text
      end

      byebug
      #mail.to_s
    end

    private

    def initialize subject, author, created_at, text
      @subject = subject
      @author = author
      @created_at = created_at
      @text = text

    end




  end


end
